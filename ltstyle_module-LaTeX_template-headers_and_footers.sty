\RequirePackage{fancyhdr} % Needed to define custom headers/footers
\RequirePackage{lastpage} % Used to determine the number of pages in the document (for "Page X of Total")

\renewcommand{\headrulewidth}{0.0pt}

\ifthenelse{\equal{\PackageOption}{default}\or\equal{\isbeamer}{true}}{}{\ifthenelse{\equal{\PackageOption}{none}\or\equal{\PackageOption}{book}}{\renewcommand{\footrulewidth}{0.0pt}}{\renewcommand{\footrulewidth}{0.4pt}}}

\AtEndPreamble{
    \AtBeginDocument{
        \ifthenelse{\equal{\PackageOption}{complet}\or\equal{\PackageOption}{TDs}\or\equal{\PackageOption}{TPs}}
        {
            \ifdefined\insertenseignementnum \else {\def\insertenseignementnum{\!\!}} \fi
            \ifthenelse{\equal{\insertenseignementnum}{\!\!}}
            {\def\insertenseignementnum{\ifthenelse{\equal{\thechapter}{0}}{\!\!}{\thechapter}}}
            {}
        }{}
    }
}

\AtBeginDocument{
\ifthenelse{\equal{\PackageOption}{default}\or\equal{\isbeamer}{true}}{
\fancypagestyle{main}{}
\fancypagestyle{plain}{}
\fancypagestyle{maintitle}{}
\fancypagestyle{plaintitle}{}
}{
\ifthenelse{\equal{\PackageOption}{book}}
{
%\setlength{\textheight}{25cm}
%\setlength{\voffset}{-1.5cm}
%\setlength{\hoffset}{-0.5cm}
\fancypagestyle{main}{
\makeatletter
\fancyhead[RE,LO]{\familyforhf }
\fancyhead[LE]{\familyforhf\small \textbf{\thepage}~~~\leftmark}
\fancyhead[RO]{\familyforhf\small \rightmark~~~\textbf{\thepage}}
\makeatother
\chead{\familyforhf }
\lfoot{\familyforhf }
\cfoot{\familyforhf }
\rfoot{\familyforhf\rfootTSVP }}

\fancypagestyle{plain}{
\makeatletter
\fancyhead[RE,LO]{\familyforhf }
\fancyhead[LE,RO]{\familyforhf\small \textbf{\thepage}}
\makeatother
\chead{\familyforhf }
\lfoot{\familyforhf }
\cfoot{\familyforhf }
\rfoot{\familyforhf\rfootTSVP }
}

\fancypagestyle{plaintitle}{
\makeatletter
\fancyhead[RE,LO]{\familyforhf }
\fancyhead[LE,RO]{\familyforhf }
\makeatother
\chead{\familyforhf }
\lfoot{\familyforhf }
\cfoot{\familyforhf }
\rfoot{\familyforhf\rfootTSVP }
}

\fancypagestyle{maintitle}{
\makeatletter
\fancyhead[RE,LO]{\familyforhf }
\fancyhead[LE,RO]{\familyforhf }
\makeatother
\chead{\familyforhf }
\lfoot{\familyforhf }
\cfoot{\familyforhf }
\rfoot{\familyforhf\rfootTSVP }
}
}{

\lfoot{\familyforhf }
\cfoot{\familyforhf \thepage /\pageref{LastPage}}
\rfoot{\familyforhf\rfootTSVP }
\lhead{\familyforhf }
\chead{\familyforhf }
\rhead{\familyforhf }

\fancypagestyle{main}{
\ifthenelse{\equal{\PackageOption}{none}}
    {}
    {\ifthenelse{\equal{\insertclasse}{}}
        {\lfoot{\familyforhf \insertinstitute}}
        {\ifthenelse{\equal{\insertinstitute}{}}
            {\lfoot{\familyforhf \insertclasse}}
            {\lfoot{\familyforhf \insertclasse~--~\insertshortinstitute}}
        }
    \ifthenelse{\equal{\PackageOption}{fiche}\or\equal{\PackageOption}{livret}\or\equal{\PackageOption}{basic}\or\equal{\PackageOption}{chapter}}
        {\ifthenelse{\equal{\insertshortenseignementtype}{}}
            {\rfoot{\familyforhf\rfootTSVP \insertmatiere}}
            {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype~\insertenseignementnum}}}
        {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype~\insertenseignementnum}}
    \ifthenelse{\equal{\insertmatiere}{}}{\rfoot{\familyforhf\rfootTSVP \insertshortenseignementtype~\insertenseignementnum}}{}
    \ifthenelse{\equal{\PackageOption}{complet}}{\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~\ifthenelse{\equal{\insertmatiere}{}}{}{--}~\chaptername~\thechapter}}{}
    }
}

\fancypagestyle{plain}{
\ifthenelse{\equal{\PackageOption}{none}}
    {}
    {\ifthenelse{\equal{\insertclasse}{}}
        {\lfoot{\familyforhf \insertinstitute}}
        {\ifthenelse{\equal{\insertinstitute}{}}
            {\lfoot{\familyforhf \insertclasse}}
            {\lfoot{\familyforhf \insertclasse~--~\insertshortinstitute}}
        }
    \ifthenelse{\equal{\PackageOption}{fiche}\or\equal{\PackageOption}{livret}\or\equal{\PackageOption}{basic}\or\equal{\PackageOption}{chapter}}
        {\ifthenelse{\equal{\insertshortenseignementtype}{}}
            {\rfoot{\familyforhf\rfootTSVP \insertmatiere}}
            {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype}}}
        {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype}}
    \ifthenelse{\equal{\insertmatiere}{}}{\rfoot{\familyforhf\rfootTSVP \insertshortenseignementtype}}{}
    \ifthenelse{\equal{\PackageOption}{complet}}{\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~Cours}}{}
    }
}
    
\fancypagestyle{maintitle}{
\ifthenelse{\equal{\PackageOption}{none}}
    {}
    {\lhead{\familyforhf \insertlongclasse\ifthenelse{\equal{\PackageOption}{fiche}\or\equal{\PackageOption}{livret}\or\equal{\PackageOption}{TD}\or\equal{\PackageOption}{TDs}\or\equal{\PackageOption}{DM}\or\equal{\PackageOption}{DS}\or\equal{\PackageOption}{controle}\or\equal{\PackageOption}{corrige}\or\equal{\PackageOption}{TP}\or\equal{\PackageOption}{TPs}\or\equal{\PackageOption}{chapter}}{\ifthenelse{\equal{\insertclasselvl}{}\and\equal{\insertclassefiliere}{}}{}{~~~\insertanneescol}}{}}
    \chead{\familyforhf }
    \rhead{\familyforhf \insertinstitute}
    \ifthenelse{\equal{\insertclasse}{}}
        {\lfoot{\familyforhf \insertinstitute}}
        {\ifthenelse{\equal{\insertinstitute}{}}
            {\lfoot{\familyforhf \insertclasse}}
            {\lfoot{\familyforhf \insertclasse~--~\insertshortinstitute}}
        }
    \ifthenelse{\equal{\PackageOption}{fiche}\or\equal{\PackageOption}{livret}\or\equal{\PackageOption}{basic}\or\equal{\PackageOption}{chapter}}
        {\ifthenelse{\equal{\insertshortenseignementtype}{}}
            {\rfoot{\familyforhf\rfootTSVP \insertmatiere}}
            {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype~\insertenseignementnum}}}
        {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype~\insertenseignementnum}}
    \ifthenelse{\equal{\insertmatiere}{}}{\rfoot{\familyforhf\rfootTSVP \insertshortenseignementtype~\insertenseignementnum}}{}
    \ifthenelse{\equal{\PackageOption}{complet}}{\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~\ifthenelse{\equal{\insertmatiere}{}}{}{--}~\chaptername~\thechapter}}{}
    }
}
    
\fancypagestyle{plaintitle}{
\ifthenelse{\equal{\PackageOption}{none}}
    {}
    {\lhead{\familyforhf \insertlongclasse\ifthenelse{\equal{\PackageOption}{fiche}\or\equal{\PackageOption}{livret}\or\equal{\PackageOption}{TD}\or\equal{\PackageOption}{TDs}\or\equal{\PackageOption}{DM}\or\equal{\PackageOption}{DS}\or\equal{\PackageOption}{controle}\or\equal{\PackageOption}{corrige}\or\equal{\PackageOption}{TP}\or\equal{\PackageOption}{TPs}\or\equal{\PackageOption}{chapter}}{\ifthenelse{\equal{\insertclasselvl}{}\and\equal{\insertclassefiliere}{}}{}{~~~\insertanneescol}}{}}
    \chead{\familyforhf }
    \rhead{\familyforhf \insertinstitute}
    \ifthenelse{\equal{\insertclasse}{}}
        {\lfoot{\familyforhf \insertinstitute}}
        {\ifthenelse{\equal{\insertinstitute}{}}
            {\lfoot{\familyforhf \insertclasse}}
            {\lfoot{\familyforhf \insertclasse~--~\insertshortinstitute}}
        }
    \ifthenelse{\equal{\PackageOption}{fiche}\or\equal{\PackageOption}{livret}\or\equal{\PackageOption}{basic}\or\equal{\PackageOption}{chapter}}
        {\ifthenelse{\equal{\insertshortenseignementtype}{}}
            {\rfoot{\familyforhf\rfootTSVP \insertmatiere}}
            {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype}}}
        {\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~\insertshortenseignementtype}}
    \ifthenelse{\equal{\insertmatiere}{}}{\rfoot{\familyforhf\rfootTSVP \insertshortenseignementtype}}{}
    \ifthenelse{\equal{\PackageOption}{complet}}{\rfoot{\familyforhf\rfootTSVP \insertshortmatiere~--~Cours}}{}
    }
}
}}

\ifthenelse{\equal{\PackageOption}{default}\or\equal{\isbeamer}{true}}{}{\pagestyle{main}}
}
