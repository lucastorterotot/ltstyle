\RequirePackage[b]{esvect}
\makeatletter
\def\vectfill@{\traitfill@\relbaredd\relbareda{\hspace{-2pt}\fldr\hspace{-1.25pt}}}
\def\traitfill@#1#2#3#4{%
  $\m@th\mkern.75mu%\relax#4#1\mkern-6mu%on met \relbaredd au d\'ebut
   \hspace{1pt}\cleaders\hbox{$\mkern0mu#2\mkern0mu$}\hfill%remplit avec relbareda
   \mkern-1.5mu#3$%
}
\makeatother
\let\origvec\vec
\newcommand{\secvec}[1]{\protect \vv{#1}}

\newlength{\myveclength}

\renewcommand{\vec}[1]{{\secvec{\protect \hphantom{#1}\protect \vphantom{#1}}} \protect \settowidth{\myveclength}{$\secvec{#1}$} \protect \mathchoice{\hspace{-\myveclength}}{\hspace{-\myveclength}}{\protect\hphantom{{}^{}}\protect \settowidth{\myveclength}{${}^{\secvec{#1}}$}\hspace{-\myveclength}}{\protect\hphantom{{}^{{}^{}}}\protect \settowidth{\myveclength}{${}^{{}^{\secvec{#1}}}$}\hspace{-\myveclength}}#1}

\let\posthyperrefvec\vec
\def\vec#1{#1}
\AtEndPreamble{\AtBeginDocument{
    \def\vec{\posthyperrefvec}
}}


\newlength{\myullength}

\let\origunderline\underline
\def\underline#1{%
\origunderline{#1%
\ifthenelse{\equal{#1}{Y}}{\!}{}%
}}

\newcommand{\getuladjust}[2][+]{%
\ifthenelse{\equal{#2}{B}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{C}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{D}}{\hspace{#1 .2em}}{}%
\ifthenelse{\equal{#2}{E}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{F}}{\hspace{#1 .3em}}{}%
\ifthenelse{\equal{#2}{G}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{H}}{\hspace{#1 .2em}}{}%
\ifthenelse{\equal{#2}{I}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{J}}{\hspace{#1 .2em}}{}%
\ifthenelse{\equal{#2}{K}}{\hspace{#1 .15em}}{}%
\ifthenelse{\equal{#2}{L}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{M}}{\hspace{#1 .15em}}{}%
\ifthenelse{\equal{#2}{N}}{\hspace{#1 .15em}}{}%
\ifthenelse{\equal{#2}{O}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{P}}{\hspace{#1 .3em}}{}%
\ifthenelse{\equal{#2}{Q}}{\hspace{#1 .05em}}{}%
\ifthenelse{\equal{#2}{R}}{\hspace{#1 .05em}}{}%
\ifthenelse{\equal{#2}{S}}{\hspace{#1 .1em}}{}%
\ifthenelse{\equal{#2}{T}}{\hspace{#1 .2em}}{}%
\ifthenelse{\equal{#2}{U}}{\hspace{#1 .2em}}{}%
\ifthenelse{\equal{#2}{V}}{\hspace{#1 .3em}}{}%
\ifthenelse{\equal{#2}{W}}{\hspace{#1 .2em}}{}%
\ifthenelse{\equal{#2}{X}}{\hspace{#1 .12em}}{}%
\ifthenelse{\equal{#2}{Y}}{\hspace{#1 .3em}}{}%
\ifthenelse{\equal{#2}{Z}}{\hspace{#1 .15em}}{}%
}

\renewcommand{\underline}[1]{\origunderline{\hphantom{#1}\getuladjust[-]{#1}} \protect \settowidth{\myullength}{${#1}$} \protect \mathchoice{\hspace{-\myullength}\getuladjust{#1}}{\hspace{-\myullength}\getuladjust{#1}}{\protect\hphantom{{}^{}}\protect \settowidth{\myullength}{${}^{{#1}}$}\hspace{-\myullength}\getuladjust{#1}}{\protect\hphantom{{}^{{}^{}}}\protect \settowidth{\myullength}{${}^{{}^{{#1}}}$}\hspace{-\myullength}\getuladjust{#1}}#1}